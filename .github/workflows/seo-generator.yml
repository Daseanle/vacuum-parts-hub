# è‡ªåŠ¨åŒ– SEO å†…å®¹ç”Ÿæˆå·¥ä½œæµ
# æ¯å¤© UTC-8 æ—¶åŒºæ—©ä¸Š 8 ç‚¹è‡ªåŠ¨ç”Ÿæˆæ–°çš„ç»´ä¿®æŒ‡å—é¡µé¢

name: ğŸ¤– SEO Auto Content Generator

on:
  # æ¯å¤©æ—©ä¸Š 8 ç‚¹è¿è¡Œï¼ˆUTC-8 æ—¶åŒºï¼Œå³ PST/MSTï¼‰
  schedule:
    - cron: '0 16 * * *'  # UTC 16:00 = UTC-8 æ—©ä¸Š 8:00
    # æ³¨æ„ï¼šPST(å¤ªå¹³æ´‹æ ‡å‡†æ—¶é—´) æˆ– MST(å±±åœ°æ ‡å‡†æ—¶é—´) çš„æ—©ä¸Š 8 ç‚¹

  # æ¯å‘¨æ—¥é¢å¤–è¿è¡Œä¸€æ¬¡ï¼Œç”Ÿæˆæ›´å¤šå†…å®¹
  schedule:
    - cron: '0 16 * * 0'  # æ¯å‘¨æ—¥æ—©ä¸Š 8 ç‚¹

  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

  # ä¹Ÿå¯ä»¥åœ¨æ¨é€åˆ° main åˆ†æ”¯æ—¶è¿è¡Œï¼ˆå¯é€‰ï¼‰
  # push:
  #   branches: [main]

permissions:
  contents: write

jobs:
  generate-seo-content:
    name: ç”Ÿæˆ SEO å†…å®¹
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸŸ¢ è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          # å¦‚æœæœ‰ requirements.txtï¼Œåœ¨è¿™é‡Œå®‰è£…

      - name: ğŸ¤– è¿è¡Œ AI å†…å®¹ç”Ÿæˆå™¨
        run: |
          python scripts/ai-content-generator.py
        env:
          # Telegram Bot é…ç½®ï¼ˆç”¨äºå‘é€æ¯æ—¥æŠ¥å‘Šï¼‰
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ  API å¯†é’¥ç­‰ç¯å¢ƒå˜é‡
          # OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          PYTHONUNBUFFERED: 1

      - name: ğŸ“Š ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š
        run: |
          echo "ğŸ“Š å†…å®¹ç”Ÿæˆç»Ÿè®¡"
          echo "===================="
          echo "ç”Ÿæˆçš„æ–‡ä»¶æ•°: $(ls -1 data/*.json 2>/dev/null | wc -l)"
          echo "æœ€æ–°æ–‡ä»¶: $(ls -t data/*.json 2>/dev/null | head -5)"
          echo ""

      - name: ğŸ“ åˆ›å»ºæäº¤
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/
          git diff --staged --quiet || git commit -m "ğŸ¤– è‡ªåŠ¨ç”Ÿæˆ SEO å†…å®¹ $(date +'%Y-%m-%d')"

      - name: ğŸš€ æ¨é€æ›´æ”¹
        run: git push

      - name: âœ… å®Œæˆé€šçŸ¥
        if: success()
        run: |
          echo "âœ… SEO å†…å®¹ç”Ÿæˆå®Œæˆï¼"
          echo "ğŸ“… æ—¶é—´: $(date)"
          echo "ğŸ”„ ä¸‹æ¬¡è¿è¡Œ: æ˜å¤©æ—©ä¸Š 8 ç‚¹ (UTC-8)"

  # å¯é€‰ï¼šéƒ¨ç½²åˆ° Vercelï¼ˆå¦‚æœç”Ÿæˆäº†æ–°å†…å®¹ï¼‰
  deploy:
    name: è§¦å‘éƒ¨ç½²
    needs: generate-seo-content
    if: success()
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ è§¦å‘ Vercel é‡æ–°éƒ¨ç½²
        run: |
          echo "âœ… æ–°å†…å®¹å·²ç”Ÿæˆï¼ŒVercel ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶éƒ¨ç½²"
          echo "ğŸŒ ç½‘ç«™å°†åœ¨å‡ åˆ†é’Ÿå†…æ›´æ–°"
